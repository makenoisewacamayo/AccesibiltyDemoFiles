<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./common_css/reset.css">
    <link rel="stylesheet" href="./common_css/text.css">
    <link rel="stylesheet" href="./common_css/960_24_col.css">
    <link rel="stylesheet" href="./common_css/demo.css">
    <script src="http://fred-wang.github.io/mathml.css/mspace.js"></script>
</head>
<body>
    <main class="container_24">
        <div class="grid_24">
            <h1>Demo de SpeechSynthesis </h1>
            <div class="cartola__audio">
                <span>
                    <button id="cartola__botonAudioPlay"><img src="assets/audio-ico.png" alt="Inicia el audio" /> </button>
                </span>
                <span>&nbsp;</span>
                <span>
                <button id="cartola__botonAudioPause">
                    <img src="assets/mute-ico.png" alt="Detiene el audio" /> </button>
                </span>
            </div>
            <section aria-labelledby="cartola__id" class="seccion" id="cartola_ultimosMovimientos">    
            <br aria-hidden="true"/>
            <span class="sr-only" id="cartola__id">Ultimos movimientos de su cartola en L&iacute;nea</span>
            <table class="seccion_cartola">
                <caption aria-hidden="true">Ultimos movimientos de su cartola en L&iacute;nea</caption>
                <tr>
                    <th scope="col" class="cartola__encabezado">Fecha</th>
                    <th scope="col" class="cartola__encabezado">Sucursal</th>
                    <th scope="col" class="cartola__encabezado">N&ordm; de Operaci&oacute;n</th>
                    <th scope="col" class="cartola__encabezado">Cheques/Cargo</th>
                    <th scope="col" class="cartola__encabezado">Dep&oacute;sitos/Abonos</th>
                    <th scope="col" class="cartola__encabezado">saldo</th>
                </tr>
                <tr class="cartola__columna">
                    <th scope="row" class="cartola__celda">
                        <span aria-hidden="true">14/02/2018</span>
                        <span class="sr-only">14 de Febrero de 2018</span>
                    </th>
                    <td class="cartola__celda">
                        <span class="sr-only">Sucursal </span>
                        STGO. PRINCIPAL
                    </td>
                    <td class="cartola__celda">
                        <math class="celda__nroOperacion" lang="es">
                            <mn>5</mn>
                            <mn>5</mn>
                            <mn>2</mn>
                            <mn>0</mn>
                            <mn>3</mn>
                            <mn>6</mn>
                        </math>
                    </td>
                    <td class="cartola__celda">
                        <span class="sr-only">Se han gastado </span>
                        <math lang="es">
                            <ms lquote="$" rquote="">
                                <mn>60.789</mn>
                            </ms>
                        </math>
                    </td>
                    <td class="cartola__celda">
                        <span class="sr-only">Se han depositado </span>
                        <math lang="es">
                            <ms lquote="$" rquote="">
                                <mn>0</mn>
                            </ms>
                        </math>
                    </td>
                    <td class="cartola__celda">
                        <span class="sr-only">Saldo en tu cuenta </span>
                        <math lang="es">
                            <ms lquote="$" rquote="">
                                <mn>400.000</mn>
                            </ms>
                        </math>
                    </td>
                </tr>
                <tr class="cartola__columna">
                    <th scope="row" class="cartola__celda">
                        <span aria-hidden="true" lang="es">12/02/2018</span>
                        <span class="sr-only">12 de Febrero de 2018</span>
                    </th>
                    <td class="cartola__celda">STGO. PRINCIPAL</td>
                    <td class="cartola__celda">
                        <math class="celda__nroOperacion" lang="es">
                            <mn>5</mn>
                            <mn>5</mn>
                            <mn>2</mn>
                            <mn>0</mn>
                            <mn>1</mn>
                            <mn>1</mn>
                        </math>
                    </td>
                    <td class="cartola__celda">
                        <span class="sr-only">Se han gastado</span>
                        <math lang="es">
                            <ms lquote="$" rquote="">
                                <mn>3.199</mn>
                            </ms>
                        </math>
                    </td>
                    <td class="cartola__celda">
                        <span class="sr-only">Se han depositado</span>
                        <math lang="es">
                            <ms lquote="$" rquote="">
                                <mn>0</mn>
                            </ms>
                        </math>
                    </td>
                    <td class="cartola__celda">
                        <span class="sr-only">Saldo en tu cuenta </span>
                        <math lang="es">
                            <ms lquote="$" rquote="">
                                <mn>460.789</mn>
                            </ms>
                        </math>
                    </td>
                </tr>
                
            </table>
            </section>
        </div>
    </main>
    <script type="text/javascript">
        var buttonPlay = document.getElementById('cartola__botonAudioPlay');
        var buttonStop = document.getElementById('cartola__botonAudioPause');
        buttonStop.setAttribute("disabled", "true");
        var pause = false;

        if ('speechSynthesis' in window) {

            var synthesis = window.speechSynthesis;
            var text = document.querySelector('table.seccion_cartola').textContent;
            text = text.replace(/(\d{1,3})\.(\d{3})/gm,"$1$2");
            
            
            var voices = synthesis.getVoices();
            var to_speak = new SpeechSynthesisUtterance();
            to_speak.lang = 'es-AR';
            to_speak.voice = voices[8];
            to_speak.rate = 0.1;
            to_speak.text = text;

            to_speak.onerror = function (event) {
                console.error("Ha ocurrido un error");
                console.error(event);
            };

            to_speak.onpause = function (event) {
                console.info("Se ha pausado");
                buttonPlay.removeAttribute("disabled");
                buttonStop.setAttribute("disabled", "true");
                pause = true;
                console.log(event);
            };

            to_speak.onresume = function (event) {
                console.info("Se reinicio");
                buttonStop.removeAttribute("disabled");
                buttonPlay.setAttribute("disabled", "true");
                console.log(event);
            };

            to_speak.onstart = function (event) {
                console.info("Ha empezado");
                buttonPlay.setAttribute("disabled", "true");
                buttonStop.removeAttribute("disabled");
                console.log(event);
            };

            to_speak.onend = function (event) {
                buttonPlay.removeAttribute("disabled");;
                buttonStop.setAttribute("disabled", "true");
                console.log("termino");
                console.log(event);
            };
            
           
            buttonPlay.addEventListener('click', function (event) {
                event.preventDefault();
                if (pause) {
                    pause = false;
                    synthesis.resume();
                } else {
                    synthesis.speak(to_speak);
                }
            });

            buttonStop.addEventListener('click', function (event) {
                event.preventDefault();
                synthesis.pause();
            });
            
        } else {
            buttonPlay.setAttribute("disabled", "true");
            buttonStop.setAttribute("disabled", "true");
            alert("No soporta speechSynthesis");
        }

    </script>

    
</body>    
</html>